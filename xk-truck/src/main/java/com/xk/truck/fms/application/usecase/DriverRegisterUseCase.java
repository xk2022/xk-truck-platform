package com.xk.truck.fms.application.usecase;import com.xk.base.util.XkBeanUtils;import com.xk.truck.fms.controller.api.dto.DriverRegisterReq;import com.xk.truck.fms.controller.api.dto.DriverResp;import com.xk.truck.fms.domain.model.Driver;import com.xk.truck.fms.domain.model.DriverStatus;import com.xk.truck.fms.domain.repository.DriverRepository;import com.xk.truck.upms.application.UpmsUserRoleService;import com.xk.truck.upms.domain.model.UpmsUser;import com.xk.truck.upms.domain.repository.UpmsUserRepository;import lombok.RequiredArgsConstructor;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;@Service@RequiredArgsConstructor@Transactionalpublic class DriverRegisterUseCase {    private final UpmsUserRepository userRepository;    private final UpmsUserRoleService userRoleService;    private final DriverRepository driverRepository;    private static final String DRIVER_ROLE_CODE = "ROLE_DRIVER";    public DriverResp register(DriverRegisterReq req) {        // Step 1. 建立 User        UpmsUser user = new UpmsUser();        user.setUsername(req.getPhone());        user.setPassword("{noop}" + req.getPhone()); // <-- MVP 密碼 = 電話        user.setEnabled(true);        user = userRepository.save(user);        // Step 2. 指派角色 DRIVER        userRoleService.assignRole(user.getUuid(), DRIVER_ROLE_CODE);        // Step 3. 建立 Driver 並寫入 userId        Driver driver = Driver.builder()                .name(req.getName())                .phone(req.getPhone())                .licenseType(req.getLicenseType())                .status(DriverStatus.ACTIVE)                .userId(user.getUuid())                .build();        driver = driverRepository.save(driver);        return XkBeanUtils.copyProperties(driver, DriverResp::new);    }}